---

harden_use_forwarding: false
harden_umask: '022'
#harden_umask: '027'
harden_init_aidedb: false
harden_unix_fstab_flags: false

## TODO: firewall rules? avoid to lock yourself
#harden_fw: false
#harden_fw: true
## Note: in default config, if you switch default policy to drop, you will lose access...
#harden_fw_default: DROP
#harden_fw_default: ACCEPT
#harden_fw_ssh_restricted:
#  - 192.168.1.0/24
#  - 10.0.0.0/8
#  - 1.1.1.1
#harden_fw_ssh_port: 22
#harden_fw_snmp_restricted:
#  - 192.168.1.100
#harden_fw_dnsservers:
#  - 192.168.1.10
#  - 192.168.1.11
#  - 8.8.8.8
#  - 8.8.4.4
#harden_fw_smtpservers:
#  - 192.168.1.20
#harden_fw_smtp_port: 25

harden_darwin_autocheckupdate: true
harden_darwin_autoupdate_apps: true
harden_darwin_autoupdate_restartrequired: false
harden_darwin_infrared: false
## https://support.apple.com/en-us/HT202842, OS X: How to disable automatic login when FileVault is enabled
## YES = double login
harden_darwin_disablefdeautologin: 'YES'
#harden_darwin_disablefdeautologin: 'NO'

harden_darwin_auditconf: openbsm-security_control.j2

## Application firewall
## 0 disabled, 1 enabled for specific services, 2 enabled for essential services only (will not allow ssh or below applications)
harden_darwin_firewall: 1
harden_darwin_firewall_allow_signedapps: false
## this is equivalent to value 2 and blocking ssh
harden_darwin_firewall_blockall_apps_in: false
harden_darwin_fw_program_allowed_in:
## the sshd line and /{usr,System} apps are only necessary if we don't allow incoming to built-in software
  - /usr/libexec/sshd-keygen-wrapper
  - /usr/sbin/netbiosd
  - /usr/libexec/sharingd
  - /System/Library/CoreServices/NetAuthAgent.app/Contents/MacOS/NetAuthSysAgent
  - /opt/local/sbin/nrpe
  - /opt/local/sbin/snmpd
  - /Library/PreferencePanes/DNSCrypt.prefPane/Contents/Resources/usr/sbin/dnscrypt-proxy
  - /Library/PreferencePanes/DNSCrypt.prefPane/Contents/Resources/usr/bin/hostip
  - /opt/local/sbin/dhcpd
  - /opt/local/sbin/tftpd
harden_darwin_fw_program_blocked_in:
  - /bin/sh
  - /usr/bin/perl
  - /usr/bin/python
  - /usr/bin/curl
  - /usr/bin/nc
  - /usr/sbin/httpd
  - /usr/sbin/ntpd
  - /Applications/iTunes.app

harden_darwin_users: []
harden_darwin_disable_bluetooth: true
harden_darwin_disable_wpad: true
harden_darwin_disable_airdrop: true
harden_darwin_disable_iclouddrive: true
harden_darwin_captiveportal: false
harden_darwin_fastuserswitching: 'YES'
#harden_darwin_fastuserswitching: 'NO'
harden_darwin_safari_javascript: false

## Experimental/Care! Will remove mass storage kext!
harden_darwin_disable_usb: false

harden_darwin_ransomwhere: false
harden_darwin_fixmacosleak: false

## Audit Tools
harden_darwin_osxlockdown: 'audit'
#harden_darwin_osxlockdown: 'run'
## FAILED! => {"changed": false, "cmd": ["/usr/bin/git", "fetch", "--tags", "origin"], "failed": true, "msg": "Failed to download remote objects and refs:  fatal: unable to access 'https://github.com/kristovatlas/osx-config-check/': The requested URL returned error: 504\n"}
harden_darwin_osxconfigcheck: false


### extra tools (use role juju4.macos-apps-install for application install, only doing configuration)
## dnscrypt
harden_darwin_dnscrypt: true

## install google santa
harden_darwin_santa: true
#harden_darwin_santa: false
harden_darwin_santa_mode: 'MONITOR'
## Be careful when activating! be sure to fit whitelist to YOUR context.
## For some reason, 'LOCKDOWN' is not working. 2 is fine to lock
#harden_darwin_santa_mode: 'LOCKDOWN'
#harden_darwin_santa_mode: 2
harden_darwin_santa_blacklist_homeuserpath: false
#$ cat /var/log/santa.log | awk -F'|' '/path=/ { gsub(/path=/, "", $5); print $5 }'| sort | uniq -c | sort -nr | head -10
#$ cat /var/log/santa.log | awk -F'|' '/path=/ && /reason=UNKNOWN/ { gsub(/path=/, "", $5); print $5 }'| sort | uniq -c | sort -nr | head -100
#decision ALLOW, DISKAPPEAR/DISKDISAPPEAR (usb/dmg)
## If binary is not signed, it will have no effect. mush be added to hash list
harden_darwin_santa_whitelist_cert:
  - /bin/sh
  - /usr/bin/ssh
  - /opt/X11/bin/xauth
  - /Applications/Firefox.app/Contents/MacOS/firefox
  - /Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome
  - /Applications/VirtualBox.app/Contents/MacOS/VirtualBox
  - /usr/local/bin/osqueryd
  - /var/_install/RansomWhere.app/Contents/MacOS/RansomWhere
  - /Library/RansomWhere/RansomWhere
  - /Applications/Wireshark.app/Contents/MacOS/dumpcap
#  - /Library/Application Support/Adobe/Flash Player Install Manager/fpsaud

#harden_darwin_santa_whitelist_hash: []
harden_darwin_santa_whitelist_hash:
  - /System/Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python
### mostly macports: keepass, smartmontools, nagios-plugins + jedda, interpreters
### not signed: DNSCrypt, vagrant
#  - /Applications/MacPorts/KeePassX.app/Contents/MacOS/KeePassX
#  - /opt/local/sbin/smartctl
#  - /opt/local/libexec/nagios/check_disk
#  - /opt/local/libexec/nagios/check_dns
#  - /opt/local/libexec/nagios/check_load
#  - /opt/local/libexec/nagios/check_ntp_time
#  - /opt/local/libexec/nagios/check_procs
#  - /opt/local/libexec/nagios/check_users
#  - /usr/local/share/OSX-Monitoring-Tools/check_osx_mem/build/Release/check_osx_mem
#  - /usr/local/share/OSX-Monitoring-Tools/check_osx_mem/build/Release/check_osx_smc
#  - /opt/local/libexec/macports/bin/tclsh8.5
#  - /opt/local/bin/perl5.24
#  - /Applications/DNSCrypt Menubar.app/Contents/MacOS/DNSCrypt Menubar
#  - /Library/PreferencePanes/DNSCrypt.prefPane/Contents/Resources/usr/bin/lockfile
#  - /Library/PreferencePanes/DNSCrypt.prefPane/Contents/Resources/usr/sbin/dnscrypt-proxy
#  - /Library/PreferencePanes/DNSCrypt.prefPane/Contents/Resources/usr/bin/alarmer
#  - /Library/PreferencePanes/DNSCrypt.prefPane/Contents/Resources/usr/bin/minisign-verify
#  - /opt/vagrant/bin/vagrant
#  - /opt/vagrant/embedded/bin/ruby
#  - /opt/vagrant/embedded/bin/curl
#  - /opt/vagrant/embedded/bin/bsdtar


harden_darwin_santa_blacklist_hash: []
## for testing purpose
#harden_darwin_santa_blacklist_hash:
#  - /usr/bin/yes

harden_darwin_osquery: true

## Archived/deprecated: MIDAS
## https://github.com/etsy/MIDAS
## https://github.com/etsy/MIDAS/tree/pre_archive

harden_darwin_launchd_services_unload: []
#harden_darwin_launchd_services_unload:
#  - /System/Library/LaunchDaemons/com.apple.RemoteDesktop.PrivilegeProxy.plist
#  - /System/Library/LaunchDaemons/com.apple.apsd.plist
#  - /System/Library/LaunchAgents/com.apple.NowPlayingTouchUI.plist

harden_darwin_set_immutable: []
#  - /var/db/santa/config.plist
harden_darwin_set_notimmutable: []

## Keychain will only affect System, Apple applications like Safari, Chrome but not Firefox
## To identify used certificates to keep, you can use
##  - NIDS like bro
##  - web proxy
##  - Firefox extension: cert patrol (but not root CA)
##      sqlite3 "$HOME/Library/Application Support/Firefox/Profiles/*.default-*/CertPatrol.sqlite"
##      sqlite> select issuerSha1Fingerprint,issuerCommonName,count(*) as c from certificates group by issuerCommonName order by c desc limit 30;
## ?Keep: Symantec, Go Daddy, DigiCert, COMODO, GeoTrust, Symantec, GlobalSign, DigiCert, Entrust, Thawte, StartCom, IdenTrust(Let's Encrypt)
## FIXME! 'security: SecKeychainItemDelete: UNIX[Operation not permitted]'. SIP ???
harden_darwin_certificates_hash_delete: []
#  - D1EB23A46D17D68FD92564C2F1F1601764D8E349
#  - F373B387065A28848AF2F34ACE192BDDC78E9CAC
#  - CCAB0EA04C2301D6697BDD379FCD12EB24E3949D
#  - 253F775B0E7797AB645F15915597C39E263631D1
#  - 30779E9315022E94856A3FF8BCF815B082F9AEFD
#  - 4A3F8D6BDC0E1ECFCD72E377DEF2D7FF92C19BC7
#  - 2F783D255218A74A653971B52CA29C45156FE919
#  - 1B4B396126276B6491A2686DD70243212D1F1D96
harden_darwin_certificates_cn_delete: []

## WARNING! Must be customized to your own usage.
## $ openssl s_client -showcerts -connect news.ycombinator.com:443 |grep issuer=
## $ openssl s_client -showcerts -connect advancedhomeserver.com:443 |grep issuer= GoDaddy???
##          www.siemplify.co?
#harden_darwin_certificates_cn_denytrust: []
harden_darwin_certificates_cn_denytrust:
## To be completed...
  - AAA Certificate Services
  - Actalis Authentication Root CA
  - AddTrust Class 1 CA Root
#  - AddTrust External CA Root      # = news.ycombinator.com
  - AddTrust Public CA Root
  - AddTrust Qualified CA Root
  - Admin-Root-CA
  - AffirmTrust Commercial
  - AffirmTrust Networking
  - AffirmTrust Premium
  - AffirmTrust Premium ECC
  - ANF Global Root CA
  - ApplicationCA
  - ApplicationCA2 Root
  - Autoridad de Certificacion Firmaprofesional CIF A62634068
  - Autoridad de Certificacion Raiz del Estado Venezolano
#  - Baltimore CyberTrust Root  # s3.amazonaws.com
  - Belgium Root CA2
  - Buypass Class 2 Root CA
  - Buypass Class 3 Root CA
  - CA Disig Root R1
  - CA Disig Root R2
## http://arstechnica.com/security/2013/12/french-agency-caught-minting-ssl-certificates-impersonating-google/
  - Certinomis - Autorité Racine
  - Certinomis - Root CA
  - Chambers of Commerce Root
  - Chambers of Commerce Root - 2008
  - Cisco Root CA 2048
  - Class 2 Primary CA
  - Common Policy
  - ComSign CA
  - ComSign Global Root CA
  - ComSign Secured CA
  - D-TRUST Root Class 3 CA 2 2009
  - D-TRUST Root Class 3 CA 2 EV 2009
  - Deutsche Telekom Root CA 2
  - DoD Root CA 2
  - DST ACES CA X6
#  - DST Root CA X3         # Let's Encrypt Authority X3
  - DST Root CA X4
  - E-Tugra Certification Authority
  - Echoworx Root CA2
  - EE Certification Centre Root CA
  - Izenpe.com
  - TÜBİTAK UEKAE Kök Sertifika Hizmet Sağlayıcısı - Sürüm 3

install_archives: /private/var/_install
backupdir: /var/_backup

