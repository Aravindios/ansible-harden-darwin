---

- hosts: all
#- hosts: test-kitchen
  vars:
    - macos_apps_install_list:
  ## osxfuse is required for veracrypt
      - { u: 'https://github.com/osxfuse/osxfuse/releases/download/osxfuse-3.7.1/osxfuse-3.7.1.dmg', v: true, s: '0982bca1661d1b8df1c310e828984b25c11dfdc623a79566bfa6283779fad24c', n: 'FUSE', t: 'pkg', m: '/Volumes/FUSE for macOS', version: '3.7.1', to: '/Library/Filesystems/osxfuse.fs', exec_name: 'FUSE for macOS.pkg', versioncmd: '/usr/libexec/PlistBuddy -c "print :CFBundleVersion" "/Library/Filesystems/osxfuse.fs/Contents/Info.plist"' }
#      - { u: 'https://download-codeplex.sec.s-msft.com/Download/Release?ProjectName=veracrypt&DownloadId=1614080&FileTime=131212015497000000&Build=21031', f: 'VeraCrypt_1.19.dmg', v: true, s: 'da098bba200d2cebb193bd699eef6dec7834c8eeb579ed40bcd21d45487e6ce7', n: 'VeraCrypt', t: 'pkg', m: '/Volumes/VeraCrypt for OSX', version: '1.19', exec_name: 'VeraCrypt_Installer.pkg' }
      - { u: 'https://launchpad.net/veracrypt/trunk/1.21/+download/VeraCrypt_1.21.dmg', v: true, s: 'cbd3f80eca753edce40be134ccbd288805c93643b21d8cf21fd72c0fd544f377', n: 'VeraCrypt', t: 'pkg', m: '/Volumes/VeraCrypt for OSX', version: '1.21', exec_name: 'VeraCrypt_Installer.pkg' }
      - { u: 'https://github.com/google/santa/releases/download/0.9.20/santa-0.9.20.dmg', v: true, s: 'dcfc535c97732380ce5a116f352110ca15ee7ebaef0eeb63b648148b21f5f3a4', n: 'santa-0.9.20', t: 'pkg', version: '0.9.20', versioncmd: '/usr/local/bin/santactl version | sed "1 s/.*| //;q"', to: '/usr/local/bin/santactl' }
      - { u: 'https://pkg.osquery.io/darwin/osquery-2.9.0.pkg', v: true, s: '83541f1241a8b92eee9cfa3dd32f384a2fd1c7ca639f138e3ec716e7ec5177a3', n: 'osquery', t: 'pkgonly', version: '2.7.0', versioncmd: '/usr/local/bin/osqueryi --version | sed "s/osqueryi version //"', to: '/usr/local/bin/osqueryi' }
      - { u: 'https://github.com/alterstep/dnscrypt-osxclient/releases/download/1.0.14/dnscrypt-osxclient-1.0.14.dmg', v: true, s: '47da81eef9e04762e9db7141dc4fdb26681940ab747677b22af50ce79b2b48bf', n: 'DNSCrypt', t: 'pkg', m: '/Volumes/dnscrypt-pkg', version: '1.0.14', versioncmd: '', to: '/Applications/DNSCrypt Menubar.app' }
## 201612 not compatible with sierra currently
#    - { u: 'https://releases.gpgtools.org/GPG_Suite-2016.10_v2.dmg', v: true, s: '8dbc5821876ca5c470d0127087f782ba02a842c52e6e19336cd935db7c5859ab' }
## FIXME! 'Request failed: <urlopen error [SSL: SSLV3_ALERT_HANDSHAKE_FAILURE] sslv3 alert handshake failure (_ssl.c:590)>' but certificate is letsencrypt/TLS1.2 support
#      - { u: 'https://releases.gpgtools.org/GPG_Suite-2017.1.dmg', v: false, s: '01705da33b9dadaf5282d28f9ef58f2eb7cd8ff6f19b4ade78861bf87668a061' }
      - { u: 'https://packages.chef.io/files/stable/inspec/1.43.5/mac_os_x/10.12/inspec-1.43.5-1.dmg', v: true, s: '44f4802764570affc0508d3177352a710ce43321981e6a49777fc6455cd19fcb', n: 'inspec', t: 'pkg', m: '/Volumes/InSpec', version: '1.43.5', exec_name: 'inspec-1.43.5-1.pkg', versioncmd: 'inspec --version 2>&1 | tail -1' }
#      - { u: '', f: '', v: true, s: 'aaaa', n: '', t: 'app', m: '/Volumes/app', version: '', versioncmd: '', to: '/Applications/example.app' }
    - harden_darwin_testing: true
    - harden_darwin_hard_fail_developertools: false
#    - harden_darwin_oversight: false
#    - harden_darwin_blockblock: false
  roles:
    - juju4.macos-apps-install
    - juju4.harden-darwin
